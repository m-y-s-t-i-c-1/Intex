const translations = {
    ro: {
        menu_home: "Acasă",
        menu_products: "Produse",
        menu_about: "Despre Noi",
        menu_faq: "FAQ",
        menu_policy: "Politica de Retur",
        menu_contact: "Contacte",
        hero_title: "Vara ta începe cu Intex",
        hero_subtitle: "Calitate premium, instalare ușoară și distracție garantată pentru întreaga familie.",
        hero_btn: "Vezi Catalogul",
        about_title: "Cine suntem noi?",
        about_p1: "Suntem unicul distribuitor oficial Intex în Moldova care îți aduce vacanța chiar la tine în curte. Cu o experiență de peste 10 ani, ne dedicăm aducerii zâmbetelor pe fețele familiilor.",
        about_p2: "Produsele noastre sunt recunoscute internațional pentru durabilitate și inovație. Fie că îți dorești o piscină imensă cu cadru metalic sau o piscină gonflabilă pentru cei mici, noi avem soluția.",
        contact_title: "Contactează-ne",
        addr_label: "Adresa:",
        phone_label: "Telefon:",
        email_label: "Email:",
        hours_label: "Program:",
        hours_val: "Luni - Duminică: 09:00 - 19:00",
        cart_title: "Coșul de Cumpărături",
        cart_total: "Total:",
        cart_empty: "Coșul este gol",
        cart_checkout: "Finalizează Comanda",
        checkout_title: "Finalizare Comandă",
        checkout_subtitle: "Completați informațiile pentru a finaliza comanda",
        checkout_order_summary: "Rezumat Comandă",
        checkout_personal_info: "Informații Personale",
        checkout_full_name: "Nume Complet",
        checkout_email: "Email",
        checkout_phone: "Telefon",
        checkout_shipping_address: "Adresa de Livrare",
        checkout_city: "Oraș",
        checkout_address: "Adresa",
        checkout_postal_code: "Cod Poștal",
        checkout_delivery_method: "Metoda de Livrare",
        checkout_standard_delivery: "Livrare Standard (5-7 zile) - 0.00 LEI",
        checkout_express_delivery: "Livrare Express (1-2 zile) - 50.00 LEI",
        checkout_payment_method: "Metoda de Plată",
        checkout_cash_on_delivery: "Plată la Livrare",
        checkout_card_payment: "Plată cu Card la Livrare",
        checkout_notes: "Note Suplimentare",
        checkout_continue_shopping: "Continuă Cumpărăturile",
        checkout_place_order: "Plasează Comanda",
        checkout_subtotal: "Subtotal:",
        checkout_shipping: "Transport:",
        checkout_total: "Total:",
        footer_about: "Despre Noi",
        footer_description: "Intex Moldova - Furnizorul oficial de piscine și accesorii INTEX în Moldova.",
        footer_contact: "Contact",
        footer_quick_links: "Linkuri Rapide"
    },
    ru: {
        menu_home: "Главная",
        menu_products: "Продукты",
        menu_about: "О Нас",
        menu_faq: "FAQ",
        menu_policy: "Политика Возврата",
        menu_contact: "Контакты",
        hero_title: "Ваше лето начинается с Intex",
        hero_subtitle: "Премиальное качество, легкая установка и гарантированное веселье для всей семьи.",
        hero_btn: "Смотреть каталог",
        about_title: "Кто мы?",
        about_p1: "Мы являемся единственным официальным дистрибьютором Intex в Молдове. Имея более чем 10-летний опыт, мы приносим радость в каждый дом.",
        about_p2: "Наша продукция всемирно известна своей долговечностью и инновациями. Будь то огромный каркасный бассейн или надувной бассейн для малышей, у нас есть решение.",
        contact_title: "Свяжитесь с нами",
        addr_label: "Адрес:",
        phone_label: "Телефон:",
        email_label: "Email:",
        hours_label: "График:",
        hours_val: "Понедельник - Воскресенье: 09:00 - 19:00",
        cart_title: "Корзина",
        cart_total: "Итого:",
        cart_empty: "Корзина пуста",
        cart_checkout: "Оформить Заказ",
        checkout_title: "Оформление Заказа",
        checkout_subtitle: "Заполните информацию для завершения заказа",
        checkout_order_summary: "Сводка Заказа",
        checkout_personal_info: "Личная Информация",
        checkout_full_name: "Полное Имя",
        checkout_email: "Email",
        checkout_phone: "Телефон",
        checkout_shipping_address: "Адрес Доставки",
        checkout_city: "Город",
        checkout_address: "Адрес",
        checkout_postal_code: "Почтовый Код",
        checkout_delivery_method: "Способ Доставки",
        checkout_standard_delivery: "Стандартная Доставка (5-7 дней) - 0.00 LEI",
        checkout_express_delivery: "Экспресс Доставка (1-2 дня) - 50.00 LEI",
        checkout_payment_method: "Способ Оплаты",
        checkout_cash_on_delivery: "Оплата при Доставке",
        checkout_card_payment: "Оплата Картой при Доставке",
        checkout_notes: "Дополнительные Примечания",
        checkout_continue_shopping: "Продолжить Покупки",
        checkout_place_order: "Разместить Заказ",
        checkout_subtotal: "Подитого:",
        checkout_shipping: "Доставка:",
        checkout_total: "Итого:",
        footer_about: "О Нас",
        footer_description: "Intex Moldova - Официальный поставщик бассейнов и аксессуаров INTEX в Молдове.",
        footer_contact: "Контакты",
        footer_quick_links: "Быстрые Ссылки"
    },
    en: {
        menu_home: "Home",
        menu_products: "Products",
        menu_about: "About Us",
        menu_faq: "FAQ",
        menu_policy: "Return Policy",
        menu_contact: "Contact",
        hero_title: "Your summer starts with Intex",
        hero_subtitle: "Premium quality, easy setup, and guaranteed fun for the whole family.",
        hero_btn: "View Catalog",
        about_title: "Who are we?",
        about_p1: "We are the sole official distributor of Intex in Moldova, bringing the holiday right to your backyard. With over 10 years of experience, we are dedicated to bringing smiles to families.",
        about_p2: "Our products are internationally recognized for durability and innovation. Whether you want a huge metal frame pool or an inflatable pool for the little ones, we have the solution.",
        contact_title: "Contact Us",
        addr_label: "Address:",
        phone_label: "Phone:",
        email_label: "Email:",
        hours_label: "Hours:",
        hours_val: "Monday - Sunday: 09:00 - 19:00",
        cart_title: "Shopping Cart",
        cart_total: "Total:",
        cart_empty: "Cart is empty",
        cart_checkout: "Checkout",
        checkout_title: "Checkout",
        checkout_subtitle: "Fill in your information to complete the order",
        checkout_order_summary: "Order Summary",
        checkout_personal_info: "Personal Information",
        checkout_full_name: "Full Name",
        checkout_email: "Email",
        checkout_phone: "Phone",
        checkout_shipping_address: "Shipping Address",
        checkout_city: "City",
        checkout_address: "Address",
        checkout_postal_code: "Postal Code",
        checkout_delivery_method: "Delivery Method",
        checkout_standard_delivery: "Standard Delivery (5-7 days) - 0.00 LEI",
        checkout_express_delivery: "Express Delivery (1-2 days) - 50.00 LEI",
        checkout_payment_method: "Payment Method",
        checkout_cash_on_delivery: "Cash on Delivery",
        checkout_card_payment: "Card Payment at Delivery",
        checkout_notes: "Additional Notes",
        checkout_continue_shopping: "Continue Shopping",
        checkout_place_order: "Place Order",
        checkout_subtotal: "Subtotal:",
        checkout_shipping: "Shipping:",
        checkout_total: "Total:",
        footer_about: "About Us",
        footer_description: "Intex Moldova - The official supplier of INTEX pools and accessories in Moldova.",
        footer_contact: "Contact",
        footer_quick_links: "Quick Links"
    }
};

const searchOverlay = document.getElementById('search-overlay');
const searchInput = document.getElementById('search-input');
const i18nElements = document.querySelectorAll('[data-i18n]');
const langOptions = document.querySelectorAll('.lang-opt');

function openSearch() {
    searchOverlay.style.display = 'flex';
    setTimeout(() => searchInput.focus(), 100);
}

function closeSearch() {
    searchOverlay.style.display = 'none';
    searchInput.value = '';
}

function performSearch(event) {
    if (event) {
        event.preventDefault(); 
    }
    
    const query = (searchInput && searchInput.value) ? searchInput.value.trim() : '';

    if (query.length > 0) {
        // Check if we're on the products page
        const isOnProductsPage = window.location.pathname.includes('produse.html') || 
                                 (typeof window.performSearch === 'function' && window.performSearch !== performSearch);
        
        if (isOnProductsPage && window.performSearch && typeof window.performSearch === 'function') {
            // We're on produse.html, call the local performSearch
            window.performSearch(query);
            closeSearch();
        } else {
            // Redirect to products page with search (use correct relative path)
            window.location.href = './pagini/produse.html?search=' + encodeURIComponent(query);
        }
    } else {
        alert("Vă rugăm să introduceți un termen de căutare.");
    }
}

function setLanguage(lang) {
    if (!translations[lang]) return;

    i18nElements.forEach(el => {
        const key = el.getAttribute('data-i18n');
        const translation = translations[lang][key];

        if (translation) {
            if (key === 'hero_btn' && el.tagName === 'A') {
                const icon = el.querySelector('i');
                el.innerHTML = translation + ' ' + (icon ? icon.outerHTML : '');
            } else {
                el.innerText = translation;
            }
        }
    });

    langOptions.forEach(span => {
        span.classList.remove('active');
        if (span.innerText.toLowerCase() === lang) {
            span.classList.add('active');
            localStorage.setItem('intex_language', lang);
        }
    });
    // Notify other scripts that language changed
    try { window.dispatchEvent(new CustomEvent('languageChanged', { detail: { lang } })); } catch (e) { /* ignore */ }
}

function initialize() {
    const savedLang = localStorage.getItem('intex_language') || 'ro';
    setLanguage(savedLang);

    document.getElementById('searchBtn').addEventListener('click', openSearch);
    
    const searchForm = document.getElementById('search-form');
    if(searchForm) {
        searchForm.addEventListener('submit', performSearch);
    } else {
        searchInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                performSearch(event);
            }
        });
    }

    langOptions.forEach(span => {
        span.addEventListener('click', () => {
            const lang = span.innerText.toLowerCase();
            setLanguage(lang);
        });
    });
}

document.addEventListener('DOMContentLoaded', initialize);